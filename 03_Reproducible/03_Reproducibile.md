---
title: "Reproducible Research"
author: "Adam M. Wilson"
date: "September 2015"
framework   : revealjs
revealjs: {theme: night, transition: fade, center: "false", width: 1080, highlighter : highlight.js, hitheme: dark, widgets: [mathjax, bootstrap,rCharts]}
# {mathjax, quiz, bootstrap}
output:
    keep_md:  true
    self_contained: true
knit        : slidify::knit2slides

---


# Reproducible <br> Research

---

## Overview
- Definitions, motives, history, spectrum
- Current practices 
- A selection of tools to improve reproducibility 
- Challenges, standards & our role in the future of reproducible research

<small>[Slides based on Ben Marwick's presentation to the UW Center for Statistics and Social Sciences (12 March 2014)](https://github.com/benmarwick/CSSS-Primer-Reproducible-Research) ([OrcID](http://orcid.org/0000-0001-7879-4531))</small>

---

> "The goal of reproducible research is to tie specific instructions to data analysis and experimental data so that scholarship can be recreated, better understood and verified."  - Max Kuhn, CRAN Task View: Reproducible Research 

---

## History of reproducible research

- Mathematics (400 BC?)
- Write scientiﬁc paper, Galileo, Pasteur, etc.  (1660s?)
- Publish a pidgin algorithm and describe simulation datasets (1950s?)
- Sell magtape of code and data (1970s?)
- Place idiosyncratic dataset & software at website (1990s?)
- Publish datasets and scripts at website, eg. biology, political science, genetics, statistics (2000s?)
- Hosted integrated code and data (2020s?)

<small>Gavish & Gonoho AAAS 2011, Oxberry 2013</small>

---

## Motivations: Claerbout's principle

>"An article about computational result is advertising, not scholarship. The actual scholarship is the full software environment, code and data, that produced the result." <small>- Claerbout and Karrenbach, Proceedings of the 62nd Annual International Meeting of the Society of Exploration Geophysics. 1992</small>
  

>"When we publish articles containing figures which were generated by computer, we also publish the complete software environment which generates the figures" <small>- Buckheit & Donoho, Wavelab and Reproducible Research, 1995.</small>

---

## Benefits are straightforward

- **Verification & Reliability**: Find and fix bugs. Today's results == tomorrow's.
- **Transparency**: increased citation count, broader impact, improved institutional memory
- **Efficiency**: Reduces duplication of effort. Payoff in the (not so) long run
- **Flexibility**: When you don’t 'point-and-click' you gain many new analytic options.

--- 
## But limitations are substantial


**Technical**

- Classified/sensitive/big data
- Nondisclosure agreements & intellectual property 
- Software licensing issues
- Competition
- Neither necessary nor sufficient for correctness (but essential for dispute resolution)


**Cultural & personal**

- Few researchers follow even minimal reproducibility standards.
- Few expect reproducibility 
- No uniform standards of reproducibility, so no established user base
- Inertia & embarassment


---

## Our work exists on a spectrum of reproducibility
![alt text](figures/peng-spectrum.jpg)
<small>Peng 2011, Science 334(6060) pp. 1226-1227</small>

---

### Goal is to expose the reader to more of the research workflow

![alt text](figures/peng-pipeline.jpg)
<small><small>http://www.stodden.net/AMP2011/slides/pengslides.pdf</small></small>

---

### Common practices of many scientists



- Enter data in Excel
- Use Excel for data cleaning & descriptive statistics
- Import data into SPSS/SAS/Stata for further analysis
- Use point-and-click options to run statistical analyses
- Copy & paste output to Word document, repeatedly



<small>![alt text](figures/lemon.png)</small>


---

### Common practices of many scientists

- Version control is ad hoc
- Excel handles missing data inconsistently and sometimes incorrectly 
- Excel uses poor algorithms for many functions
- Scripting is possible but rare 



<small>![alt text](figures/phd-comic-vcs.gif)</small>

---

## Click trails are ephemeral & dangerous

- Lots of human effort for tedious & time-wasting tasks
- Error-prone due to manual & ad hoc data handling (column and row offsets are common)
- Difficult to record -  hard to reconstruct a 'click history'
- Tiny changes in data or method require extensive reworking efforts



![alt text](figures/contrails.jpg)

---

## Case study: Reinhart and Rogoff controversy

`
 
`
![alt text](figures/reinhart_rogoff_coding_error_0.png)



`
`
- Claimed that higher debt-to-G.D.P. ratios are associated with lower levels of G.D.P. growth
- Identified the threshold to -ve growth at a debt-to-G.D.P. ratio of >90%
- Substantial popular impact on autsterity politics 


---

## Case study: Reinhart and Rogoff controversy

<img src="figures/reinhart_rogoff_econ_mag.png" alt="alt text" width="800">


---
## Who Cares?

#### In May 2015 _Science_ retracted a study of how canvassers can sway people's opinions about gay marriage published just 5 months ago.

> Original survey data not made available for independent reproduction of results. + Survey incentives misrepresented. + Sponsorship statement false.

<small>- Science Editor-in-Chief Marcia McNutt</small>

Two Berkeley grad students who attempted to replicate the study quickly discovered that the data must have been faked.

[Source](http://news.sciencemag.org/policy/2015/05/science-retracts-gay-marriage-paper-without-lead-author-s-consent)

---
#### 2013 Seizure study retracted after authors realize data got "terribly mixed"
> The article has been retracted at the request of the authors. After carefully re-examining the data presented in the article, they identified that data of two different hospitals got terribly mixed. The published results cannot be reproduced in accordance with scientific and clinical correctness.

<small> -Authors of Low Dose Lidocaine for Refractory Seizures in Preterm Neonates </small>

[Source](http://retractionwatch.com/2013/02/01/seizure-study-retracted-after-authors-realize-data-got-terribly-mixed/)

---

#### Bad spreadsheet merge kills depression paper, quick fix resurrects it
Authors informed the journal that the merge of lab results and other survey data used in the paper resulted in an error regarding the identification codes. Results of the analyses were based on the data set in which this error occurred. Further analyses established the results reported in this manuscript and interpretation of the data are not correct.

Original conclusion: *Lower levels of CSF IL-6 were associated with current depression and with future depression […]*

Revised conclusion: *Higher levels of CSF IL-6 and IL-8 were associated with current depression […]*

[Source](http://retractionwatch.com/2014/07/01/bad-spreadsheet-merge-kills-depression-paper-quick-fix-resurrects-it/)


---

## Scripted analyses are superior



![alt text](figures/open-science.png)



- Plain text files will be readable for a long time
- Improved transparency, automation, maintanability, accessibility, standardisation, modularity, portability, efficiency, communicability of process (what more could we want?)
- But there's a steep learning curve  



---

## Literate statistical programming 

>"Instead of imagining that our main task is to instruct a computer what to do, let us concentrate rather on explaining to humans what we want the computer to do."-- <small>Donald E. Knuth, Literate Programming, 1984</small>



For example...
Let's calculate the current time in R.

```r
time <- format(Sys.time(), "%a %d %b %X %Y")
```
The text and R code are interwoven in the output:

The time is `` `r time` ``

The time is Thu 17 Sep 16:48:27 2015


---

## Literate programming: for and against 

**For**

- Text and code all in one place, in logical order
- Tables and figures automatically updated to reflect data and method changes
- Automatic test when building document

**Against**

- Text and code all in one place; can be hard to read sometimes, especially if there is a lot of code
- Can substantially slow down the processing of documents
(although caching can help)


---

## Need a programming language

The machine-readable part

R: Free, open source, cross-platform, highly interactive, huge user community in academica and private sector

R packages: an ideal 'Compendium'?

![alt text](figures/r-project.jpg)


* Scriptability → R
* Literate programming → R Markdown
* Version control → Git / GitHub

> "both a container for the different elements that make up the document and its computations (i.e. text, code, data, etc.), and as a means for distributing, managing and updating the collection... allow us to move from an era of advertisement to one where our scholarship itself is published" <small>- Gentleman and Temple Lang 2004</small>


---

## Very low barrier to documentation of code with roxygen2


<img src="figures/roxygen2.jpg" alt="alt text" width="800">


---

## Interactive charts in the browser with the rCharts package

<iframe srcdoc=' &lt;!doctype HTML&gt;
&lt;meta charset = &#039;utf-8&#039;&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&#039;stylesheet&#039; href=&#039;//cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.css&#039;&gt;
    
    &lt;script src=&#039;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    &lt;script src=&#039;//d3js.org/d3.v3.min.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    &lt;script src=&#039;//cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    &lt;script src=&#039;//nvd3.org/assets/lib/fisheye.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    
    &lt;style&gt;
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 800px;
      height: 400px;
    }  
    &lt;/style&gt;
    
  &lt;/head&gt;
  &lt;body &gt;
    
    &lt;div id = &#039;chartdbc748634c1&#039; class = &#039;rChart nvd3&#039;&gt;&lt;/div&gt;    
    &lt;script type=&#039;text/javascript&#039;&gt;
 $(document).ready(function(){
      drawchartdbc748634c1()
    });
    function drawchartdbc748634c1(){  
      var opts = {
 &quot;dom&quot;: &quot;chartdbc748634c1&quot;,
&quot;width&quot;:    800,
&quot;height&quot;:    400,
&quot;x&quot;: &quot;wt&quot;,
&quot;y&quot;: &quot;mpg&quot;,
&quot;type&quot;: &quot;scatterChart&quot;,
&quot;id&quot;: &quot;chartdbc748634c1&quot; 
},
        data = [
 {
 &quot;mpg&quot;:             21,
&quot;cyl&quot;:              6,
&quot;disp&quot;:            160,
&quot;hp&quot;:            110,
&quot;drat&quot;:            3.9,
&quot;wt&quot;:           2.62,
&quot;qsec&quot;:          16.46,
&quot;vs&quot;:              0,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:             21,
&quot;cyl&quot;:              6,
&quot;disp&quot;:            160,
&quot;hp&quot;:            110,
&quot;drat&quot;:            3.9,
&quot;wt&quot;:          2.875,
&quot;qsec&quot;:          17.02,
&quot;vs&quot;:              0,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           22.8,
&quot;cyl&quot;:              4,
&quot;disp&quot;:            108,
&quot;hp&quot;:             93,
&quot;drat&quot;:           3.85,
&quot;wt&quot;:           2.32,
&quot;qsec&quot;:          18.61,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:           21.4,
&quot;cyl&quot;:              6,
&quot;disp&quot;:            258,
&quot;hp&quot;:            110,
&quot;drat&quot;:           3.08,
&quot;wt&quot;:          3.215,
&quot;qsec&quot;:          19.44,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:           18.7,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            360,
&quot;hp&quot;:            175,
&quot;drat&quot;:           3.15,
&quot;wt&quot;:           3.44,
&quot;qsec&quot;:          17.02,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           18.1,
&quot;cyl&quot;:              6,
&quot;disp&quot;:            225,
&quot;hp&quot;:            105,
&quot;drat&quot;:           2.76,
&quot;wt&quot;:           3.46,
&quot;qsec&quot;:          20.22,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:           14.3,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            360,
&quot;hp&quot;:            245,
&quot;drat&quot;:           3.21,
&quot;wt&quot;:           3.57,
&quot;qsec&quot;:          15.84,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           24.4,
&quot;cyl&quot;:              4,
&quot;disp&quot;:          146.7,
&quot;hp&quot;:             62,
&quot;drat&quot;:           3.69,
&quot;wt&quot;:           3.19,
&quot;qsec&quot;:             20,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              4,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           22.8,
&quot;cyl&quot;:              4,
&quot;disp&quot;:          140.8,
&quot;hp&quot;:             95,
&quot;drat&quot;:           3.92,
&quot;wt&quot;:           3.15,
&quot;qsec&quot;:           22.9,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              4,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           19.2,
&quot;cyl&quot;:              6,
&quot;disp&quot;:          167.6,
&quot;hp&quot;:            123,
&quot;drat&quot;:           3.92,
&quot;wt&quot;:           3.44,
&quot;qsec&quot;:           18.3,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              4,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           17.8,
&quot;cyl&quot;:              6,
&quot;disp&quot;:          167.6,
&quot;hp&quot;:            123,
&quot;drat&quot;:           3.92,
&quot;wt&quot;:           3.44,
&quot;qsec&quot;:           18.9,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              4,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           16.4,
&quot;cyl&quot;:              8,
&quot;disp&quot;:          275.8,
&quot;hp&quot;:            180,
&quot;drat&quot;:           3.07,
&quot;wt&quot;:           4.07,
&quot;qsec&quot;:           17.4,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              3 
},
{
 &quot;mpg&quot;:           17.3,
&quot;cyl&quot;:              8,
&quot;disp&quot;:          275.8,
&quot;hp&quot;:            180,
&quot;drat&quot;:           3.07,
&quot;wt&quot;:           3.73,
&quot;qsec&quot;:           17.6,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              3 
},
{
 &quot;mpg&quot;:           15.2,
&quot;cyl&quot;:              8,
&quot;disp&quot;:          275.8,
&quot;hp&quot;:            180,
&quot;drat&quot;:           3.07,
&quot;wt&quot;:           3.78,
&quot;qsec&quot;:             18,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              3 
},
{
 &quot;mpg&quot;:           10.4,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            472,
&quot;hp&quot;:            205,
&quot;drat&quot;:           2.93,
&quot;wt&quot;:           5.25,
&quot;qsec&quot;:          17.98,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           10.4,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            460,
&quot;hp&quot;:            215,
&quot;drat&quot;:              3,
&quot;wt&quot;:          5.424,
&quot;qsec&quot;:          17.82,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           14.7,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            440,
&quot;hp&quot;:            230,
&quot;drat&quot;:           3.23,
&quot;wt&quot;:          5.345,
&quot;qsec&quot;:          17.42,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           32.4,
&quot;cyl&quot;:              4,
&quot;disp&quot;:           78.7,
&quot;hp&quot;:             66,
&quot;drat&quot;:           4.08,
&quot;wt&quot;:            2.2,
&quot;qsec&quot;:          19.47,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:           30.4,
&quot;cyl&quot;:              4,
&quot;disp&quot;:           75.7,
&quot;hp&quot;:             52,
&quot;drat&quot;:           4.93,
&quot;wt&quot;:          1.615,
&quot;qsec&quot;:          18.52,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           33.9,
&quot;cyl&quot;:              4,
&quot;disp&quot;:           71.1,
&quot;hp&quot;:             65,
&quot;drat&quot;:           4.22,
&quot;wt&quot;:          1.835,
&quot;qsec&quot;:           19.9,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:           21.5,
&quot;cyl&quot;:              4,
&quot;disp&quot;:          120.1,
&quot;hp&quot;:             97,
&quot;drat&quot;:            3.7,
&quot;wt&quot;:          2.465,
&quot;qsec&quot;:          20.01,
&quot;vs&quot;:              1,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:           15.5,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            318,
&quot;hp&quot;:            150,
&quot;drat&quot;:           2.76,
&quot;wt&quot;:           3.52,
&quot;qsec&quot;:          16.87,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           15.2,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            304,
&quot;hp&quot;:            150,
&quot;drat&quot;:           3.15,
&quot;wt&quot;:          3.435,
&quot;qsec&quot;:           17.3,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           13.3,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            350,
&quot;hp&quot;:            245,
&quot;drat&quot;:           3.73,
&quot;wt&quot;:           3.84,
&quot;qsec&quot;:          15.41,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           19.2,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            400,
&quot;hp&quot;:            175,
&quot;drat&quot;:           3.08,
&quot;wt&quot;:          3.845,
&quot;qsec&quot;:          17.05,
&quot;vs&quot;:              0,
&quot;am&quot;:              0,
&quot;gear&quot;:              3,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           27.3,
&quot;cyl&quot;:              4,
&quot;disp&quot;:             79,
&quot;hp&quot;:             66,
&quot;drat&quot;:           4.08,
&quot;wt&quot;:          1.935,
&quot;qsec&quot;:           18.9,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              1 
},
{
 &quot;mpg&quot;:             26,
&quot;cyl&quot;:              4,
&quot;disp&quot;:          120.3,
&quot;hp&quot;:             91,
&quot;drat&quot;:           4.43,
&quot;wt&quot;:           2.14,
&quot;qsec&quot;:           16.7,
&quot;vs&quot;:              0,
&quot;am&quot;:              1,
&quot;gear&quot;:              5,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           30.4,
&quot;cyl&quot;:              4,
&quot;disp&quot;:           95.1,
&quot;hp&quot;:            113,
&quot;drat&quot;:           3.77,
&quot;wt&quot;:          1.513,
&quot;qsec&quot;:           16.9,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              5,
&quot;carb&quot;:              2 
},
{
 &quot;mpg&quot;:           15.8,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            351,
&quot;hp&quot;:            264,
&quot;drat&quot;:           4.22,
&quot;wt&quot;:           3.17,
&quot;qsec&quot;:           14.5,
&quot;vs&quot;:              0,
&quot;am&quot;:              1,
&quot;gear&quot;:              5,
&quot;carb&quot;:              4 
},
{
 &quot;mpg&quot;:           19.7,
&quot;cyl&quot;:              6,
&quot;disp&quot;:            145,
&quot;hp&quot;:            175,
&quot;drat&quot;:           3.62,
&quot;wt&quot;:           2.77,
&quot;qsec&quot;:           15.5,
&quot;vs&quot;:              0,
&quot;am&quot;:              1,
&quot;gear&quot;:              5,
&quot;carb&quot;:              6 
},
{
 &quot;mpg&quot;:             15,
&quot;cyl&quot;:              8,
&quot;disp&quot;:            301,
&quot;hp&quot;:            335,
&quot;drat&quot;:           3.54,
&quot;wt&quot;:           3.57,
&quot;qsec&quot;:           14.6,
&quot;vs&quot;:              0,
&quot;am&quot;:              1,
&quot;gear&quot;:              5,
&quot;carb&quot;:              8 
},
{
 &quot;mpg&quot;:           21.4,
&quot;cyl&quot;:              4,
&quot;disp&quot;:            121,
&quot;hp&quot;:            109,
&quot;drat&quot;:           4.11,
&quot;wt&quot;:           2.78,
&quot;qsec&quot;:           18.6,
&quot;vs&quot;:              1,
&quot;am&quot;:              1,
&quot;gear&quot;:              4,
&quot;carb&quot;:              2 
} 
]
  
      if(!(opts.type===&quot;pieChart&quot; || opts.type===&quot;sparklinePlus&quot; || opts.type===&quot;bulletChart&quot;)) {
        var data = d3.nest()
          .key(function(d){
            //return opts.group === undefined ? &#039;main&#039; : d[opts.group]
            //instead of main would think a better default is opts.x
            return opts.group === undefined ? opts.y : d[opts.group];
          })
          .entries(data);
      }
      
      if (opts.disabled != undefined){
        data.map(function(d, i){
          d.disabled = opts.disabled[i]
        })
      }
      
      nv.addGraph(function() {
        var chart = nv.models[opts.type]()
          .width(opts.width)
          .height(opts.height)
          
        if (opts.type != &quot;bulletChart&quot;){
          chart
            .x(function(d) { return d[opts.x] })
            .y(function(d) { return d[opts.y] })
        }
          
         
        
          
        

        
        
        
      
       d3.select(&quot;#&quot; + opts.id)
        .append(&#039;svg&#039;)
        .datum(data)
        .transition().duration(500)
        .call(chart);

       nv.utils.windowResize(chart.update);
       return chart;
      });
    };
&lt;/script&gt;
    
    &lt;script&gt;&lt;/script&gt;    
  &lt;/body&gt;
&lt;/html&gt; ' scrolling='no' frameBorder='0' seamless class='rChart  nvd3  ' id='iframe-chartdbc748634c1'> </iframe>
 <style>iframe.rChart{ width: 100%; height: 400px;}</style>

---

## Interactive charts in the browser with the rCharts package


<iframe srcdoc=' &lt;!doctype HTML&gt;
&lt;meta charset = &#039;utf-8&#039;&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;link rel=&#039;stylesheet&#039; href=&#039;//cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.css&#039;&gt;
    
    &lt;script src=&#039;//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    &lt;script src=&#039;//d3js.org/d3.v3.min.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    &lt;script src=&#039;//cdnjs.cloudflare.com/ajax/libs/nvd3/1.1.15-beta/nv.d3.min.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    &lt;script src=&#039;//nvd3.org/assets/lib/fisheye.js&#039; type=&#039;text/javascript&#039;&gt;&lt;/script&gt;
    
    &lt;style&gt;
    .rChart {
      display: block;
      margin-left: auto; 
      margin-right: auto;
      width: 800px;
      height: 500px;
    }  
    &lt;/style&gt;
    
  &lt;/head&gt;
  &lt;body &gt;
    
    &lt;div id = &#039;chartdbc5f374063&#039; class = &#039;rChart nvd3&#039;&gt;&lt;/div&gt;    
    &lt;script type=&#039;text/javascript&#039;&gt;
 $(document).ready(function(){
      drawchartdbc5f374063()
    });
    function drawchartdbc5f374063(){  
      var opts = {
 &quot;dom&quot;: &quot;chartdbc5f374063&quot;,
&quot;width&quot;:    800,
&quot;height&quot;:    500,
&quot;x&quot;: &quot;Hair&quot;,
&quot;y&quot;: &quot;Freq&quot;,
&quot;group&quot;: &quot;Eye&quot;,
&quot;type&quot;: &quot;multiBarChart&quot;,
&quot;id&quot;: &quot;chartdbc5f374063&quot; 
},
        data = [
 {
 &quot;Hair&quot;: &quot;Black&quot;,
&quot;Eye&quot;: &quot;Brown&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             32 
},
{
 &quot;Hair&quot;: &quot;Brown&quot;,
&quot;Eye&quot;: &quot;Brown&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             53 
},
{
 &quot;Hair&quot;: &quot;Red&quot;,
&quot;Eye&quot;: &quot;Brown&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             10 
},
{
 &quot;Hair&quot;: &quot;Blond&quot;,
&quot;Eye&quot;: &quot;Brown&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:              3 
},
{
 &quot;Hair&quot;: &quot;Black&quot;,
&quot;Eye&quot;: &quot;Blue&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             11 
},
{
 &quot;Hair&quot;: &quot;Brown&quot;,
&quot;Eye&quot;: &quot;Blue&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             50 
},
{
 &quot;Hair&quot;: &quot;Red&quot;,
&quot;Eye&quot;: &quot;Blue&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             10 
},
{
 &quot;Hair&quot;: &quot;Blond&quot;,
&quot;Eye&quot;: &quot;Blue&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             30 
},
{
 &quot;Hair&quot;: &quot;Black&quot;,
&quot;Eye&quot;: &quot;Hazel&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             10 
},
{
 &quot;Hair&quot;: &quot;Brown&quot;,
&quot;Eye&quot;: &quot;Hazel&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             25 
},
{
 &quot;Hair&quot;: &quot;Red&quot;,
&quot;Eye&quot;: &quot;Hazel&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:              7 
},
{
 &quot;Hair&quot;: &quot;Blond&quot;,
&quot;Eye&quot;: &quot;Hazel&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:              5 
},
{
 &quot;Hair&quot;: &quot;Black&quot;,
&quot;Eye&quot;: &quot;Green&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:              3 
},
{
 &quot;Hair&quot;: &quot;Brown&quot;,
&quot;Eye&quot;: &quot;Green&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:             15 
},
{
 &quot;Hair&quot;: &quot;Red&quot;,
&quot;Eye&quot;: &quot;Green&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:              7 
},
{
 &quot;Hair&quot;: &quot;Blond&quot;,
&quot;Eye&quot;: &quot;Green&quot;,
&quot;Sex&quot;: &quot;Male&quot;,
&quot;Freq&quot;:              8 
} 
]
  
      if(!(opts.type===&quot;pieChart&quot; || opts.type===&quot;sparklinePlus&quot; || opts.type===&quot;bulletChart&quot;)) {
        var data = d3.nest()
          .key(function(d){
            //return opts.group === undefined ? &#039;main&#039; : d[opts.group]
            //instead of main would think a better default is opts.x
            return opts.group === undefined ? opts.y : d[opts.group];
          })
          .entries(data);
      }
      
      if (opts.disabled != undefined){
        data.map(function(d, i){
          d.disabled = opts.disabled[i]
        })
      }
      
      nv.addGraph(function() {
        var chart = nv.models[opts.type]()
          .width(opts.width)
          .height(opts.height)
          
        if (opts.type != &quot;bulletChart&quot;){
          chart
            .x(function(d) { return d[opts.x] })
            .y(function(d) { return d[opts.y] })
        }
          
         
        
          
        

        
        
        
      
       d3.select(&quot;#&quot; + opts.id)
        .append(&#039;svg&#039;)
        .datum(data)
        .transition().duration(500)
        .call(chart);

       nv.utils.windowResize(chart.update);
       return chart;
      });
    };
&lt;/script&gt;
    
    &lt;script&gt;&lt;/script&gt;    
  &lt;/body&gt;
&lt;/html&gt; ' scrolling='no' frameBorder='0' seamless class='rChart  nvd3  ' id='iframe-chartdbc5f374063'> </iframe>
 <style>iframe.rChart{ width: 100%; height: 400px;}</style>


---

## Need a document formatting language

`
 
`
<img src="figures/markdown.png" alt="alt text" width="400">

Markdown: lightweight document formatting syntax. Easy to write, read and publish as-is.


The human-readable part

`rmarkdown`: 
- minor extensions to allow R code display and execution
- embed images in html files (convenient for sharing)
- equations

---

## Dynamic documents in R

knitr - descendant of Sweave  

Engine for dynamic report generation in R

<img src="figures/knitr.png" alt="alt text" width="400">




- Narrative and code in the same file or explicitly linked
- When data or narrative are updated, the document is automatically updated
- Data treated as 'read only'
- Output treated as disposable

---

## Pandoc: document converter

`
`

A universal document converter, open source, cross-platform

-> Write code and narrative in rmarkdown   
-> knitr->markdown (with computation)   
-> use pandoc to get HTML/PDF/DOCX



`
`

![alt text](figures/pandoc-workflow-rmd-md.png)
<small><small>http://kieranhealy.org/blog/archives/2014/01/23/plain-text/ </small></small>

---

## Tracking changes with version control 

Payoffs
- Eases collaboration
- Can track changes in any file type (ideally plain text)
- Can revert file to any point in its tracked history

Costs
- Learning curve



![alt text](figures/git.png)
![alt text](figures/github.png)
![alt text](figures/bitbucket.png)

---

## Environment for reproducible research


![alt text](figures/rstudio.png)



Has an integrated R console, deep support for markdown and git, package development tools, etc. etc.

RStudio 'projects' make version control & document preparation simple




---

## Depositing code and data

Payoffs
- Free space for hosting (and paid options)
- Assignment of persistent DOIs
- Tracking citation metrics 

Costs
- Sometimes license restrictions (CC-BY & CC0)
- Limited or no private storage space


![alt text](figures/figshare.png)
![alt text](figures/dryad.png)
![alt text](figures/zenodo.png)


---

## A hierarchy of reproducibility 

- **Good**: Use code with an integrated development environment (IDE). Minimize pointing and clicking (RStudio)
- **Better**: Use version control. Help yourself keep track of changes, fix bugs and improve project management (RStudio & Git & GitHub or BitBucket)
- **Best**: Use embedded narrative and code to explicitly link code, text and data, save yourself time, save reviewers time, improve your code. (RStudio & Git & GitHub or BitBucket & rmarkdown & knitr & data repository)


---

<img src="figures/VictoriaStoddenIASSISTJune2010-reasons-to.png" alt="alt text" width="800">
<small>Stodden (IASSIST 2010) sampled American academics registered at the Machine Learning conference NIPS (134 responses from 593 requests (23%). Red = communitarian norms, Blue = private incentives</small>


---

<img src="figures/VictoriaStoddenIASSISTJune2010-reasons.png" alt="alt text" width="800">
<small>Stodden (IASSIST 2010) sampled American academics registered at the Machine Learning conference NIPS (134 responses from 593 requests (23%). Red = communitarian norms, Blue = private incentives</small>


---

## Standards to normalise reproducible research

- Schwab et al.: 
  - ER (Easily reproducible)
  - CR (Conditionally reproducible)
  - NR (Not reproducible)
- _Biostatistics_ kite-marking of articles (Peng 2009)
  - D (data)
  - C (code)
  - R (both)

---

## Standards to normalise reproducible research

- Reproducible Research Standard (Stodden 2009): we should release 
 - The full compendium on the internet
 - Media such as text, figures, tables with Creative Commons Attribution license (CC-BY) 
 - Code with one of Apache 2.0, MIT, LGPL, BSD, etc.
 - Original "selection and arrangement" of data with CC0 or CC-BY

---

## Biggest challenge: culture change is the 

- Promote culture change through positive attribution 
- Implement mechanisms to indicate & encourage **degrees of compliance** (ie. clear definitions for different levels of reproducibility), cf. Stodden's:
 - **'Reproducible'**: compendium of text-code-data online
 - **'Reproduced'**: compendium available and independently reproduced 
 - **'Semi-Reproducible'**: when the full compendium is not released
 - **'Semi-Reproduced'**: independent reproduction with other data
 - **'Perpetually Reproducible'**: streaming data

---

## Our role in the future of reproducible research (Leveque et al 2012)

- Train students by putting homework, assignments & dissertations on the reproducible research spectrum
- Publish examples of reproducible research in our field
- Request code & data when reviewing
- Submit to & review for journals that support reproducible research
- Critically review & audit data management plans in grant proposals
- Consider reproducibility wherever possible in hiring, promotion & reference letters.

Thanks! 

---

> Abandoning the habit of secrecy in favor of process transparency and peer review was the crucial step by which alchemy became chemistry.

<small>-Raymond, E. S., 2004, The art of UNIX programming: Addison-Wesley.</small>


---

## Colophon

[Slides based on Ben Marwick's presentation to the UW Center for Statistics and Social Sciences (12 March 2014)](https://github.com/benmarwick/CSSS-Primer-Reproducible-Research) ([OrcID](http://orcid.org/0000-0001-7879-4531))

Licensing: 
* Presentation: [CC-BY-3.0 ](http://creativecommons.org/licenses/by/3.0/us/)
* Source code: [MIT](http://opensource.org/licenses/MIT) 


---

## References

See [Rpres file on github](https://raw.github.com/benmarwick/CSSS-Primer-Reproducible-Research/master/CSSS_WI14_Reproducibility.Rpres) for full references and sources


